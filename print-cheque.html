<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Print Cheque - Manual Entry - ARG Distributor</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/print-cheque.css">
</head>

<body>
    <!-- Sidebar -->
    <div id="sidebar-placeholder"></div>

    <script src="js/common.js"></script>
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="header-logo">
                    <span>A R G Distributor pvt LTD</span>
                </div>
            </div>

            <div class="header-right">
                <span class="welcome-text">Welcome, Admin</span>
                <button class="logout-btn" onclick="window.location.href='index.html'">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <!-- Page Content -->
        <div class="page-content">
            <!-- Page Header -->
            <div class="page-header-section">
                <div>
                    <h1 class="page-title">Print Cheque - Manual Entry</h1>
                    <p class="page-description">Enter cheque details manually and print</p>
                </div>
                <div>
                    <button class="btn-back" onclick="window.location.href='dashboard.html'">
                        <i class="fas fa-arrow-left"></i>
                        Back to Dashboard
                    </button>
                </div>
            </div>

            <!-- Print Form Section -->
            <div class="print-form-section">
                <div class="print-header">
                    <i class="fas fa-print"></i>
                    <div>
                        <h2>Manual Cheque Printing</h2>
                        <p>Enter cheque details and arrange them for printing</p>
                    </div>
                </div>

                <form id="printChequeForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-calendar"></i>
                                Cheque Date <span class="required">*</span>
                            </label>
                            <input type="date" class="form-control" id="chequeDate" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-user"></i>
                                Payee Name <span class="required">*</span>
                            </label>
                            <input type="text" class="form-control" id="payeeName" placeholder="Enter payee name"
                                required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-money-bill"></i>
                                Amount (LKR) <span class="required">*</span>
                            </label>
                            <input type="number" class="form-control" id="amount" placeholder="0.00" step="0.01"
                                required>
                        </div>
                    </div>

                    <div class="checkbox-section">
                        <label class="checkbox-container">
                            <input type="checkbox" id="crossCheque">
                            <span class="checkmark"></span>
                            <div class="checkbox-label">
                                <i class="fas fa-ban"></i>
                                Cross Cheque (Account Payee Only)
                            </div>
                        </label>
                        <p class="checkbox-help">Check this box to print "Account Payee Only" on the cheque</p>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-arrows-alt-v"></i>
                                Amount in Words Line Gap (px)
                            </label>
                            <input type="number" class="form-control" id="lineGap" value="12" min="0" max="20">
                            <p class="field-help">Line spacing (0-20px)</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-text-width"></i>
                                Words Per Line
                            </label>
                            <input type="number" class="form-control" id="wordsPerLine" value="7" min="3" max="15">
                            <p class="field-help">Words per line (3-15)</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-text-height"></i>
                                Font Size (px)
                            </label>
                            <input type="number" class="form-control" id="fontSize" value="14" min="8" max="24">
                            <p class="field-help">Font size (8-24px)</p>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-preview">
                            <i class="fas fa-eye"></i>
                            Preview Cheque
                        </button>
                        <button type="button" class="btn-clear" id="clearFormBtn">
                            <i class="fas fa-eraser"></i>
                            Clear Form
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Cheque Preview Modal -->
    <div class="modal-overlay" id="chequePreviewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-eye"></i> Cheque Preview</h3>
                <button class="modal-close" id="closeModalBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="virtual-cheque" id="virtualCheque">
                    <!-- Crossing -->
                    <div class="crossing" id="chequeCrossing">
                        <div class="crossing-text">Account Payee Only</div>
                    </div>

                    <!-- Bank Info -->
                    <div class="cheque-bank-info">
                        Commercial Bank of Ceylon PLC
                    </div>

                    <!-- Date -->
                    <div class="cheque-date" id="chequePreviewDate">
                        <!-- Date Chars will go here -->
                        D D M M Y Y Y Y
                    </div>

                    <!-- Payee -->
                    <div class="cheque-payee-row">
                        <span class="cheque-payee-label">Pay</span>
                        <div class="cheque-payee-name" id="chequePreviewPayee">
                            <!-- Payee Name -->
                        </div>
                    </div>

                    <!-- Amount Words -->
                    <div class="cheque-amount-words-row">
                        <span class="cheque-amount-words-label">Rupees</span>
                        <div class="cheque-amount-words" id="chequePreviewWords">
                            <!-- Amount in words -->
                        </div>
                    </div>

                    <!-- Amount Figures -->
                    <div class="cheque-amount-figures-box">
                        <span class="cheque-currency">LKR</span>
                        <div class="cheque-amount-figures" id="chequePreviewAmount">
                            <!-- Format: **50,000.00 -->
                        </div>
                    </div>

                    <!-- Footer / Signature -->
                    <div class="cheque-signature-area">
                        Authorized Signatory
                    </div>

                    <div class="cheque-footer-micr">
                        001234: 00056789: 1234
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal-cancel" id="cancelPrintBtn">Cancel</button>
                <button class="btn-print-confirm" id="confirmPrintBtn">
                    <i class="fas fa-print"></i> Confirm & Print
                </button>
            </div>
        </div>
    </div>

    <script>
        // Sidebar Toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');

        sidebarToggle.addEventListener('click', (e) => {
            e.stopPropagation();

            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('show');
            } else {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
            }
        });

        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768) {
                if (!sidebar.contains(e.target) && !sidebarToggle.contains(e.target)) {
                    sidebar.classList.remove('show');
                }
            }
        });

        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                sidebar.classList.remove('show');
            }
        });

        // Submenu Toggle - keeping generic logic for consistency
        const chequeOpsToggle = document.getElementById('chequeOpsToggle');
        if (chequeOpsToggle) {
            const chequeOpsItem = chequeOpsToggle.closest('.nav-item');
            chequeOpsToggle.addEventListener('click', (e) => {
                e.preventDefault();
                chequeOpsItem.classList.toggle('expanded');
            });
        }

        const scheduleToggle = document.getElementById('scheduleToggle');
        if (scheduleToggle) {
            const scheduleItem = scheduleToggle.closest('.nav-item');
            scheduleToggle.addEventListener('click', (e) => {
                e.preventDefault();
                scheduleItem.classList.toggle('expanded');
            });
        }

        const bankToggle = document.getElementById('bankToggle');
        if (bankToggle) {
            const bankItem = bankToggle.closest('.nav-item');
            bankToggle.addEventListener('click', (e) => {
                e.preventDefault();
                bankItem.classList.toggle('expanded');
            });
        }

        // Number to Words Conversion (Verified)
        function numberToWords(num) {
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];

            if (num === 0) return 'Zero';

            function convertHundreds(n) {
                let str = '';
                if (n > 99) {
                    str += ones[Math.floor(n / 100)] + ' Hundred ';
                    n %= 100;
                }
                if (n > 19) {
                    str += tens[Math.floor(n / 10)] + ' ';
                    n %= 10;
                }
                if (n > 9) {
                    str += teens[n - 10] + ' ';
                    return str;
                }
                if (n > 0) {
                    str += ones[n] + ' ';
                }
                return str;
            }

            let word = '';
            if (num >= 1000000) {
                word += convertHundreds(Math.floor(num / 1000000)) + 'Million ';
                num %= 1000000;
            }
            if (num >= 1000) {
                word += convertHundreds(Math.floor(num / 1000)) + 'Thousand ';
                num %= 1000;
            }
            word += convertHundreds(num);

            return word.trim();
        }

        // Modal Logic
        const modal = document.getElementById('chequePreviewModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelPrintBtn = document.getElementById('cancelPrintBtn');
        const confirmPrintBtn = document.getElementById('confirmPrintBtn');

        function hideModal() {
            modal.classList.remove('show');
        }

        closeModalBtn.addEventListener('click', hideModal);
        cancelPrintBtn.addEventListener('click', hideModal);

        confirmPrintBtn.addEventListener('click', function () {
            window.print();
        });

        // Form submission & Preview Generation
        const form = document.getElementById('printChequeForm');
        form.addEventListener('submit', function (e) {
            e.preventDefault();

            const chequeDate = document.getElementById('chequeDate').value;
            const payeeName = document.getElementById('payeeName').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const crossCheque = document.getElementById('crossCheque').checked;
            const lineGap = document.getElementById('lineGap').value;
            const wordsPerLine = document.getElementById('wordsPerLine').value; // Can use for wrapping logic if needed
            const fontSize = document.getElementById('fontSize').value;

            if (!chequeDate || !payeeName || !amount) {
                alert('Please fill in all required fields');
                return;
            }

            // Convert Amount to Words
            const integerPart = Math.floor(amount);
            const decimalPart = Math.round((amount - integerPart) * 100);

            let amountInWords = numberToWords(integerPart);
            if (decimalPart > 0) {
                amountInWords += ' and ' + decimalPart + '/100';
            }
            amountInWords += ' Only';

            // Populate Virtual Cheque
            // Date Format: 2025-12-14 -> 1 4 1 2 2 0 2 5 (with spaces)
            if (chequeDate) {
                const d = new Date(chequeDate);
                const day = String(d.getDate()).padStart(2, '0');
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const year = d.getFullYear();

                // Construct Date Box string
                let dateStr = `${day.charAt(0)} ${day.charAt(1)} ${month.charAt(0)} ${month.charAt(1)} ${String(year).charAt(0)} ${String(year).charAt(1)} ${String(year).charAt(2)} ${String(year).charAt(3)}`;
                document.getElementById('chequePreviewDate').textContent = dateStr;
            }

            document.getElementById('chequePreviewPayee').textContent = payeeName;
            document.getElementById('chequePreviewWords').textContent = amountInWords;
            document.getElementById('chequePreviewAmount').textContent = '**' + amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

            // Apply Crossing
            const crossingEl = document.getElementById('chequeCrossing');
            if (crossCheque) {
                crossingEl.classList.add('show');
            } else {
                crossingEl.classList.remove('show');
            }

            // Apply Styles
            const wordsEl = document.getElementById('chequePreviewWords');
            const payeeEl = document.getElementById('chequePreviewPayee');

            // Dynamic Font Size update
            const size = fontSize + 'px';
            wordsEl.style.fontSize = size;
            payeeEl.style.fontSize = size;

            // Dynamic Line Gap (using css var or direct style)
            wordsEl.style.lineHeight = (parseInt(lineGap) + parseInt(fontSize)) + 'px'; // approx

            // Show Modal
            modal.classList.add('show');
        });

        // Clear form logic
        const clearBtn = document.getElementById('clearFormBtn');
        clearBtn.addEventListener('click', function () {
            if (confirm('Are you sure you want to clear the form?')) {
                form.reset();
                document.getElementById('lineGap').value = '12';
                document.getElementById('wordsPerLine').value = '7';
                document.getElementById('fontSize').value = '14';
            }
        });

        console.log('Print Cheque page loaded successfully!');
    </script>
</body>

</html>